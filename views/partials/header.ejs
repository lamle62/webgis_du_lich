<!-- HEADER – THANH TRÊN CÙNG -->
<header id="topPanel">
  <div class="header-inner">
    <!-- BÊN TRÁI: USER PANEL -->
    <div class="user-panel">
      <% if (user) { %>
        <div class="user-name">Xin chào, <strong><%= user.username || user.name %></strong></div>
        <div class="user-links">
          <a href="#" onclick="openProfileModal(); return false;">Hồ sơ</a>
          <a href="/user/logout">Đăng xuất</a>
        </div>
      <% } else { %>
        <div class="user-guest">Chào mừng khách</div>
        <div class="auth-buttons">
          <a href="/user/login" class="btn btn-primary">Đăng nhập</a>
          <a href="/user/register" class="btn btn-ghost">Đăng ký</a>
        </div>
      <% } %>
    </div>

    <!-- BÊN PHẢI: FILTER FORM -->
    <form id="filter-form" onsubmit="event.preventDefault(); filterPlaces(event);">
      <select id="type-filter" name="type">
        <option value="">-- Chọn loại --</option>
        <option value="tourism">Địa điểm du lịch</option>
        <option value="hotel">Khách sạn</option>
        <option value="restaurant">Nhà hàng</option>
      </select>
      <input type="text" id="province-filter" name="province" placeholder="Nhập tỉnh/thành" />
      <button type="submit" class="btn btn-primary">Lọc</button>
      <button type="button" class="btn btn-ghost" onclick="resetFilter()">Xóa</button>
    </form>
  </div>
</header>

<script src="/js/main.js" defer></script>

<!-- ===================== NÚT HỒ SƠ ===================== -->
<li class="nav-item">
  <a href="#" id="profile-btn" class="nav-link">
    <i class="bi bi-person-circle"></i> Hồ sơ
  </a>
</li>

<!-- ===================== MODAL HỒ SƠ ===================== -->
<div id="profile-modal" class="modal" style="
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.4);
  justify-content: center; align-items: center;
  z-index: 9999;
">
  <div style="
    background: white;
    border-radius: 10px;
    padding: 20px 30px;
    width: 360px;
    max-width: 90%;
    position: relative;
    box-shadow: 0 4px 20px rgba(0,0,0,0.2);
  ">
    <button id="close-profile" style="
      position: absolute;
      top: 8px; right: 12px;
      border: none; background: none;
      font-size: 20px; cursor: pointer;
    ">&times;</button>

    <div style="text-align: center;">
      <img id="profile-avatar" src="/images/default-avatar.png"
           alt="Avatar"
           style="width: 90px; height: 90px; border-radius: 50%; object-fit: cover; border: 2px solid #ddd;">
      <h3 id="profile-username" style="margin-top: 10px; font-size: 1.2em;">Đang tải...</h3>
    </div>

    <div id="profile-info" style="margin-top: 15px; text-align: left; line-height: 1.6;">
      <p><strong>Email:</strong> <span id="profile-email">...</span></p>
      <p><strong>Điện thoại:</strong> <span id="profile-phone">...</span></p>
      <p><strong>Ngày tham gia:</strong> <span id="profile-created">...</span></p>
    </div>
  </div>
</div>

<!-- ===================== SCRIPT FETCH HỒ SƠ ===================== -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const profileBtn = document.getElementById('profile-btn');
    const profileModal = document.getElementById('profile-modal');
    const closeBtn = document.getElementById('close-profile');

    if (!profileBtn) return;

    profileBtn.addEventListener('click', async (e) => {
      e.preventDefault();
      profileModal.style.display = 'flex';

      try {
        const res = await fetch('/user/profile-data');
        const data = await res.json();

        if (data.success) {
          const u = data.data;
          document.getElementById('profile-avatar').src = u.avatar || '/images/default-avatar.png';
          document.getElementById('profile-username').textContent = u.username;
          document.getElementById('profile-email').textContent = u.email;
          document.getElementById('profile-phone').textContent = u.phone || 'Chưa cập nhật';
          document.getElementById('profile-created').textContent = 
  u.createdAt ? new Date(u.createdAt).toLocaleDateString('vi-VN') : 'Không rõ';

        } else {
          document.getElementById('profile-info').innerHTML =
            '<p style="color:red;">Không thể tải thông tin hồ sơ.</p>';
        }
      } catch (err) {
        console.error('Lỗi tải hồ sơ:', err);
        document.getElementById('profile-info').innerHTML =
          '<p style="color:red;">Lỗi kết nối máy chủ.</p>';
      }
    });

    // Ẩn modal khi nhấn nút đóng hoặc vùng ngoài
    closeBtn.addEventListener('click', () => (profileModal.style.display = 'none'));
    window.addEventListener('click', (e) => {
      if (e.target === profileModal) profileModal.style.display = 'none';
    });
  });
</script>


