<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin - Quản lý địa điểm</title>
  <link rel="stylesheet" href="/css/styles.css">
  <style>
    .admin-content {
      margin-left: 280px;
      padding: 24px;
      min-height: calc(100vh - 48px);
    }

    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }

    .search-bar {
      padding: 10px 14px;
      border: 1px solid rgba(15,23,42,0.08);
      border-radius: 8px;
      font-size: 0.95em;
      width: 300px;
    }

    .search-bar:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(13,110,253,0.1);
    }

    .table-actions {
      display: flex;
      gap: 8px;
    }

    .btn-edit {
      background: #ffc107;
      color: white;
    }

    .btn-edit:hover {
      background: #e0a800;
    }

    .btn-delete {
      background: var(--danger);
      color: white;
    }

    .btn-delete:hover {
      background: #c82333;
    }

    @media (max-width: 820px) {
      .admin-content { margin-left: 0; padding: 16px; }
      .page-header { flex-direction: column; gap: 12px; align-items: stretch; }
      .search-bar { width: 100%; }
    }
  </style>
</head>
<body>
  <%- include('partials/header') %>

  <div class="admin-content">
    <div class="page-header">
      <h1>Quản lý địa điểm</h1>
      <div style="display: flex; gap: 12px;">
        <input type="text" class="search-bar" placeholder="Tìm kiếm địa điểm..." onkeyup="searchPlaces(this.value)">
        <a href="/admin/places/create" class="btn btn-primary">+ Thêm mới</a>
      </div>
    </div>

    <div class="card">
      <table id="places-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Tên địa điểm</th>
            <th>Loại</th>
            <th>Tỉnh/TP</th>
            <th>Trạng thái</th>
            <th>Thao tác</th>
          </tr>
        </thead>
        <tbody>
          <% places.forEach(place => { %>
            <tr data-id="<%= place._id %>">
              <td>#<%= place._id.toString().slice(-6) %></td>
              <td><%= place.name %></td>
              <td>
                <span class="badge <%= place.type === 'tourism' ? 'bg-primary' : place.type === 'hotel' ? 'bg-success' : 'bg-warning' %>">
                  <%= place.type === 'tourism' ? 'Du lịch' : place.type === 'hotel' ? 'Khách sạn' : 'Nhà hàng' %>
                </span>
              </td>
              <td><%= place.province %></td>
              <td>
                <span class="badge <%= place.active ? 'bg-success' : 'bg-danger' %>">
                  <%= place.active ? 'Hoạt động' : 'Ẩn' %>
                </span>
              </td>
              <td class="table-actions">
                <a href="/admin/places/edit/<%= place._id %>" class="btn btn-small btn-edit">Sửa</a>
                <button class="btn btn-small btn-delete" onclick="deletePlace('<%= place._id %>')">
                  Xóa
                </button>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
  </div>

  <script>
    async function deletePlace(id) {
      if (!confirm('Xóa địa điểm này? Không thể khôi phục!')) return;
      const res = await fetch(`/admin/places/${id}`, { method: 'DELETE' });
      if (res.ok) {
        document.querySelector(`tr[data-id="${id}"]`).remove();
      } else {
        alert('Xóa thất bại');
      }
    }

    function searchPlaces(query) {
      const rows = document.querySelectorAll('#places-table tbody tr');
      rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(query.toLowerCase()) ? '' : 'none';
      });
    }
  </script>
</body>
</html>